<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aiglon Futé - Dashboard Avancé</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="main-wrapper">
        <div class="container">
            <header>
                <h1 class="main-title">AIGLON FUTÉ</h1>
                <p>Dashboard Pôle Performance trafic SNA CE</p>
            </header>

            <main>
                <div class="card">
                    <h2 class="card-title">Source des Données</h2>
                    <div class="controls-row">
                        <div class="data-source-section">
                            <button id="loadSummerDataBtn" class="data-source-btn" data-tooltip="Base de donnée COHOR et pattern temporel pour trafic TMA selon l'historique 2024. Analyse du trafic saisonnier. Il est possible de sélectionner une période et d'analyser le trafic moyen et max.">
                                Aiglon futé été
                            </button>
                            <p id="summerDataStatus" class="data-status-display"></p>
                        </div>
                        <div class="data-source-section">
                            <button id="loadWinterDataBtn" class="data-source-btn" data-tooltip="Base de donnée COHOR et pattern temporel pour trafic TMA selon l'historique 2024. Analyse du trafic saisonnier. Il est possible de sélectionner une période et d'analyser le trafic moyen et max.">
                                Aiglon futé hiver
                            </button>
                            <p id="winterDataStatus" class="data-status-display"></p>
                        </div>
                        <div class="data-source-section">
                            <button id="loadNMPredictDataBtn" class="data-source-btn" data-tooltip="Base de donnée NM avec le B2B Eurocontrol et certificat PREOPS (non opérationnel valide pour des tests). Analyse journalier des 4 prochains jours">
                                NM Predict
                            </button>
                            <p id="nmPredictDataStatus" class="data-status-display" style="display: none;"></p>
                        </div>
                    </div>
                </div>

                    <div id="dashboardContent" class="hidden">
                        <div class="card">
                            <h2 class="card-title">Synthèse</h2>
                            <div id="synthesisContent">
                                <!-- Le contenu de la synthèse sera inséré ici dynamiquement -->
                            </div>
                        </div>

                    <div class="stats-grid">
                        <div class="card stat-card">
                            <h3 class="stat-title">Départs / jour</h3>
                            <p id="avgDep" class="stat-value">0</p>
                        </div>
                        <div class="card stat-card">
                            <h3 class="stat-title">Arrivées / jour</h3>
                            <p id="avgArr" class="stat-value">0</p>
                        </div>
                        <div class="card stat-card">
                            <h3 class="stat-title">TMA / jour</h3>
                            <p id="avgTma" class="stat-value">0</p>
                        </div>
                        <div class="card stat-card">
                            <h3 class="stat-title">Total / jour (moy.)</h3>
                            <p id="avgTotal" class="stat-value">0</p>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Filtres Interactifs</h2>
                        <div class="date-controls-container">
                            <div class="date-inputs">
                                <label for="dateStartInput">Début:</label>
                                <input type="date" id="dateStartInput" disabled>
                                <label for="dateEndInput">Fin:</label>
                                <input type="date" id="dateEndInput" disabled>
                            </div>
                        </div>
                        <div class="toggles-container">
                            <div class="filter-group-vertical">
                                <label for="periodSelect">Grille de vacation</label>
                                <select id="periodSelect" class="select-dropdown">
                                    <optgroup label="Période Chargée">
                                        <option value="SemCha">Semaine Chargée</option>
                                        <option value="SamCha">Samedi Chargé</option>
                                        <option value="DimCha">Dimanche Chargée</option>
                                    </optgroup>
                                    <optgroup label="Période Creuse">
                                        <option value="SemCre">Semaine Creuse</option>
                                        <option value="SamCre">Samedi Creuse</option>
                                        <option value="DimCre">Dimanche Creuse</option>
                                    </optgroup>
                                    <optgroup label="Période Hiver">
                                        <option value="SemHiv">Semaine Hiver</option>
                                        <option value="SamHiv">Samedi Hiver</option>
                                        <option value="DimHiv">Dimanche Hiver</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="filter-group-vertical">
                                <label>Jours de la semaine</label>
                                <div id="dayOfWeekToggles" class="toggle-group"></div>
                            </div>
                            <div class="filter-group-vertical">
                                <label>Types de trafic</label>
                                <div id="trafficTypeToggles" class="toggle-group"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="chart-header">
                            <div class="chart-controls-group chart-controls-left">
                                <button id="toggleStackedBtn" class="button-secondary selected">Vue Empilée</button>
                                <button id="toggleSideBySideBtn" class="button-secondary">Vue Côte à Côte</button>
                            </div>
                            <h2 class="card-title">Trafic moyen par créneau horaire</h2>
                            <div class="chart-controls-group chart-controls-right">
                                <button id="toggleUTCBtn" class="button-secondary selected">UTC</button>
                                <button id="toggleLocalBtn" class="button-secondary">Heure locale</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>

                    <div id="capacityControlsCard" class="card hidden">
                        <h2 id="capacityEffectifTitle" class="card-title">Contrôles de Capacité</h2>
                        <div class="capacity-controls-row">
                            <div class="control-group">
                                <label for="sivSelect">Hypothèse SIV</label>
                                <select id="sivSelect" class="select-dropdown">
                                    <option value="fermé">Fermé</option>
                                    <option value="VFR faible">Faible</option>
                                    <option value="VFR moyen">Moyen</option>
                                    <option value="VFR fort" selected>Fort</option>
                                </select>
                            </div>
                            <div class="toggle-group" id="vacationTogglesJe"></div>
                            <div class="toggle-group" id="vacationTogglesM"></div>
                        </div>
                        <div class="capacity-controls-row">
                            <div class="toggle-group" id="vacationTogglesJ"></div>
                            <div class="toggle-group" id="vacationTogglesSN"></div>
                        </div>
                    </div>
                    
                    <div id="predictNMSummaryCard" class="card hidden">
                        <h2 class="card-title">Résumé des imports Predict NM</h2>
                        <div id="predictNMSummaryContent">
                            <!-- Le résumé des imports sera inséré ici -->
                        </div>
                    </div>

                    <div id="predictNMTableCard" class="card hidden">
                        <div class="card-header">
                            <h2 class="card-title">Liste des vols Predict NM</h2>
                            <button id="togglePredictNMTableBtn" class="button-secondary toggle-button">Afficher</button>
                        </div>
                        <div class="table-container hidden" id="predictNMTableContainer">
                            <table id="predictNMTable">
                                <thead>
                                    <tr>
                                        <th>Heure</th>
                                        <th>ARCID</th>
                                        <th>Type Avion</th>
                                        <th>ADEP</th>
                                        <th>ADES</th>
                                    </tr>
                                    <tr class="filter-row">
                                        <th>
                                            <input type="text" id="timeRangeFilter" class="column-filter" placeholder="12h00-13h00">
                                        </th>
                                        <th>
                                            <input type="text" id="arcidFilter" class="column-filter" placeholder="Filtrer ARCID">
                                        </th>
                                        <th>
                                            <input type="text" id="atypFilter" class="column-filter" placeholder="Filtrer Type">
                                        </th>
                                        <th>
                                            <input type="text" id="adepFilter" class="column-filter" placeholder="Filtrer ADEP">
                                        </th>
                                        <th>
                                            <input type="text" id="adesFilter" class="column-filter" placeholder="Filtrer ADES">
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Les vols Predict NM seront insérés ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="d3-heatmap-container" class="card"></div>

                </div>
                
                <div id="initialMessage" class="card">
                    <p>Veuillez charger une source de données pour commencer...</p>
                </div>
            </main>
        </div>
    </div>
    <script src="staffingMap.js"></script>
    <script src="sivRules.js"></script>
    <script src="vacationGrids.js"></script>
    <script src="CapacityCalculator.js"></script>
    
    <!-- Fichiers de données intégrées -->
    <script src="summer_cohorData.js"></script>
    <script src="winter_cohorData.js"></script>
    <script src="tmaData.js"></script>
    <script src="nmpredictj0Data.js"></script>
    <script src="nmpredictj1Data.js"></script>
    <script src="nmpredictj2Data.js"></script>
    <script src="nmpredictj3Data.js"></script>
    <script src="nmpredictj4Data.js"></script>
    
    <script src="scriptCore.js"></script>
    <script src="scriptCohor.js"></script>
    <script src="scriptNM.js"></script>
    <script src="dataLoader.js"></script>
    <!-- Le fichier script.js original n'est plus nécessaire -->
</body>
</html>
